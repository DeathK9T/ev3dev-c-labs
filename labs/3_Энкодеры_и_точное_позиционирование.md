# Лабораторная №3. Энкодеры и точное позиционирование

## Что такое энкодер?

Энкодер — это датчик, который измеряет угол поворота оси двигателя. Каждый двигатель EV3 имеет встроенный оптический энкодер с разрешением 360 отсчетов на оборот, который:

- Считает обороты оси двигателя в градусах
- Работает в диапазоне от -∞ до +∞
- Сбрасывается в 0 при запуске программы
- Позволяет точно определить положение робота

## Преимущества управления по энкодеру

### Проблемы управления по времени

При управлении движением по времени возникают следующие проблемы:

- Скорость робота зависит от заряда батареи
- Сопротивление движению может изменяться
- Время разгона и торможения не учитывается
- Точность снижается со временем работы

### Решение через энкодеры

- Точное измерение реального перемещения
- Независимость от внешних факторов
- Возможность точной остановки в заданной точке

## Математические соотношения

### Связь угла энкодера и расстояния

distance = (encoder_angle / 360°) × π × wheel_diameter

### Связь поворота робота и энкодера

robot_angle = encoder_angle / (wheel_diameter / wheel_base)

**Где:**

- **wheel_diameter** - диаметр колеса робота
- **wheel_base** - расстояние между колесами (диаметр робота)

## Чтение энкодера

```c
long getMotorEncoder(tMotor мотор);  // Возвращает угол поворота в градусах
```

## Циклы while

Цикл `while` выполняет код до тех пор, пока условие истинно:

```c
while (условие) {
    // Код, выполняемый в цикле
}
```

В языке C:

- `true` — любое значение ≠ 0
- `false` — значение 0

## Логические операции

```c
x == y   // Равно
x != y   // Не равно
x > y    // Больше
x < y    // Меньше
x >= y   // Больше или равно
x <= y   // Меньше или равно
x && y   // И (логическое умножение)
x || y   // ИЛИ (логическое сложение)
!x       // НЕ (логическое отрицание)
```

## Задачи для выполнения

### Задача 3.1

Создайте программу, которая непрерывно выводит на экран значения энкодеров обоих двигателей. Поворачивая колеса вручную, убедитесь в правильности показаний.

### Задача 3.2

Реализуйте функцию `moveEnc(float distance)` и подберите правильное значение диаметра колеса, чтобы робот точно проезжал заданное расстояние.

### Задача 3.3

Реализуйте функцию `turnEnc(float alfa)` и подберите правильное значение расстояния между колесами.

### Задача 3.4

Реализуйте функцию `moveXY(float X, float Y)`, которая перемещает робота из текущей точки в точку с координатами (X, Y) относительно текущего положения.

Когда мы хотим, чтобы робот поехал к точке с координатами (X,Y)относительно его текущего положения, нам нужно решить две задачи:

1. Определить расстояние до цели.

    По теореме Пифагора расстояние до точки (X,Y) вычисляется как:

    $$d=\sqrt{X^2 + Y^2}$$

    Это длина вектора, тянущегося от робота к цели.

    В коде используем для $\sqrt{}$ функцию `sqrt(double number)`, а для возведения в квадрат - либо умножаем число само на себя ($X*X$), либо используем функцию `pow(double base, double exponent)`.

2. Определить направление, куда ехать.

    Угол поворота можно найти через функцию арктангенса:

    $$\phi=arctan⁡(Y/X)$$

    На практике мы используем функцию `atan2(double y, double x)`, которая сразу возвращает правильный угол в радианах.

### Задача 3.5

Создайте программу, состоящую только из вызовов `moveXY(float X, float Y)`, для прохождения маршрута через 5 точек на столе.
