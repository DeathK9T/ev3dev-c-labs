# Подготовка окружения для работы с EV3dev

## Содержание

  1. [Общие сведения об EV3dev](#общие-сведения-об-ev3dev)
  2. [Настройка Visual Studio Code](#настройка-visual-studio-code)
  3. [Настройка окружения](#настройка-окружения)
  4. [Настройка сети для подключения EV3dev к компьютеру](#настройка-сети-для-подключения-ev3dev-к-компьютеру)
  5. [Начало работы с EV3dev](#начало-работы-с-ev3dev)

---

## Общие сведения об EV3dev

  **EV3dev** — это операционная система на основе Debian Linux, которая работает на LEGO MINDSTORMS EV3 и позволяет программировать роботов на различных языках программирования.

### Преимущества EV3dev

- Поддержка языков программирования C/C++
- Полный доступ к аппаратным возможностям EV3
- Совместимость с Visual Studio Code
- Открытый исходный код
- Активное сообщество разработчиков

### Системные требования

- USB кабель для подключения к компьютеру
- Компьютер с Windows или Linux (Ubuntu)
- Visual Studio Code
- EV3 с предустановленной системой EV3dev

### Используемая библиотека

  В данном руководстве используется библиотека **rbc.h** (упрощенная библиотека "brick") из пакета ev3dev-c, которая предоставляет простой интерфейс для управления моторами и сенсорами EV3.

---

## Настройка Visual Studio Code

### Установка VS Code

#### Для Ubuntu

  Установите Visual Studio Code через Ubuntu Software или выполните команды в терминале (для открытия нажать Ctrl+Alt+T):

  ```bash
  sudo apt update
  sudo snap install code --classic
  ```

#### Для Windows

1. Перейдите на [https://code.visualstudio.com/](https://code.visualstudio.com/)
2. Скачайте установщик для Windows
3. Запустите установщик и следуйте инструкциям
4. После установки запустите Visual Studio Code

### Установка необходимых расширений

1. Откройте VS Code
2. Перейдите во вкладку Extensions (Ctrl+Shift+X)
3. Установите следующие расширения:
   - **C/C++ Extension Pack**

---

## Настройка окружения

### Настройка task'и для отправки и компиляции кода на EV3dev

1. Нажмите сочетание клавиш `Ctrl+Shift+P`
2. Введите "Tasks: Configure Task" и выберите этот пункт
3. Выберите "Create tasks.json from file template" → "Others"
4. Вставьте следующий код в файл tasks.json:

  ```json
  {
      "tasks": [
          {
              "type": "shell",
              "label": "EV3Dev: Send program",
              "command": "scp",
              "args": [
                  "${file}",
                  "robot@ev3dev.local:/home/robot/"
              ],
              "presentation": {
                  "reveal": "silent",
                  "panel": "shared",
                  "clear": true
              }
          },
          {
              "type": "shell",
              "label": "EV3Dev: Compile program",
              "command": "ssh",
              "args": [
                  "robot@ev3dev.local",
                  "gcc ${fileBasename} -pthread -lev3dev-c -lm -o ${fileBasenameNoExtension}"
              ],
              "presentation": {
                  "reveal": "silent",
                  "panel": "shared"
              }
          },
          {
              "type": "shell",
              "label": "EV3Dev: Run program",
              "command": "ssh",
              "args": [
                  "robot@ev3dev.local",
                  "./${fileBasenameNoExtension}"
              ],
              "presentation": {
                  "reveal": "silent",
                  "panel": "shared",
                  "close": true
              }
          },
          {
              "label": "EV3Dev: Send and Compile program",
              "dependsOrder": "sequence",
              "dependsOn": [
                  "EV3Dev: Send program",
                  "EV3Dev: Compile program"
              ],
              "presentation": {
                  "reveal": "silent",
                  "panel": "shared",
                  "clear": true
              }
          },
          {
              "label": "EV3Dev: Send, Compile and Run program",
              "dependsOrder": "sequence",
              "dependsOn": [
                  "EV3Dev: Send program",
                  "EV3Dev: Compile program",
                  "EV3Dev: Run program"
              ]
          }
      ],
      "version": "2.0.0"
  }
  ```

### Настройка settings.json для отладки

1. Нажмите `Ctrl+Shift+P`
2. Введите "Preferences: Open User Settings (JSON)"
3. Добавьте в settings.json:

  ```json
  {
      "launch": {
          "version": "0.2.0",
          "configurations": [
              {
                  "name": "EV3Dev: Compile and Run program",
                  "type": "cppdbg",
                  "request": "launch",
                  "program": "ssh",
                  "args": [
                      "robot@ev3dev.local",
                      "./${fileBasenameNoExtension}"
                  ],
                  "cwd": "${fileDirname}",
                  "preLaunchTask": "EV3Dev: Send and Compile program"
              }
          ],
          "compounds": []
      }
  }
  ```

### Настройка горячих клавиш

1. Нажмите `Ctrl+Shift+P`
2. Введите "Preferences: Open Keyboard Shortcuts (JSON)"
3. Добавьте в keybindings.json:

  ```json
  [
      {
          "key": "ctrl+shift+F5",
          "command": "workbench.action.tasks.runTask",
          "args": "EV3Dev: Send, Compile and Run program"
      }
  ]
  ```

### Установка библиотеки для подсказок

1. Скачать этот репозиторий, если еще не сделали этого _(в терминале)_:

    ```bash
    git clone https://github.com/deathk9t/ev3dev-c-labs
    ```

2. Перейти в папку репозитория

    ```bash
    cd ev3dev-c-labs
    ```

3. Скопировать все неоходимые файлы в системную папку

    ```bash
    sudo cp -r resources/ev3dev/* /usr/include
    ```

---

## Настройка сети для подключения EV3dev к компьютеру

### Для Ubuntu

1. Подключите робота к компьютеру через USB-кабель
2. Откройте терминал (`Ctrl+Alt+T`)
3. Выполните команду:

    ```bash
    nm-connection-editor
    ```

4. В окне Network Connections нажмите "+"
5. Выберите "Ethernet" → "Create..."
6. В поле "Connection name" введите: `ev3dev`
7. В поле "Device" выберите MAC адрес робота (узнать можно на EV3: Wireless and Networks → All Network Connections → Wired → ENET)
8. Перейдите во вкладку "IPv4 Settings"
9. В поле "Method" выберите "Shared to other computers"
10. Нажмите "Save"

### Для Windows _(только в случае если не работает без этого)_

1. Подключите EV3 к компьютеру через USB
2. Дождитесь установки драйверов
3. Откройте "Панель управления" → "Центр управления сетями и общим доступом"
4. Нажмите "Изменение параметров адаптера"
5. Найдите новое подключение (обычно называется "RNDIS")
6. Щелкните правой кнопкой → "Свойства"
7. Выберите "Протокол Интернета версии 4 (TCP/IPv4)" → "Свойства"
8. Выберите "Получить IP-адрес автоматически"
9. Нажмите "OK"

#### Настройка общего доступа к интернету (ICS) _(только в случае если не работает без этого)_

1. Найдите ваше основное интернет-подключение
2. Щелкните правой кнопкой → "Свойства"
3. Перейдите во вкладку "Доступ"
4. Отметьте "Разрешить другим пользователям сети использовать подключение к Интернету данного компьютера"
5. В выпадающем списке выберите подключение к EV3
6. Нажмите "OK"

### Настройка на EV3

1. На роботе перейдите: Wireless and Networks → All Network Connections → Wired
2. Установите галочку "Connect automatically"
3. Нажмите "Connect"
4. Дождитесь появления IP-адреса в левом верхнем углу

---

## Начало работы с EV3dev

### Подключение к EV3 в VS Code

1. Включите EV3 с предустановленной системой EV3dev
2. Подключите EV3 к компьютеру через USB
3. Дождитесь появления IP-адреса на экране EV3
4. Откройте VS Code
5. Откройте папку проекта (`Ctrl+Shift+N` → "Open Folder")

### Создание первой программы на C++ с библиотекой rbc.h

Библиотека **rbc.h** является упрощенной версией библиотеки ev3dev-c, которая использует маски портов вместо индексов устройств, что делает программирование более простым.

1. Создайте новый файл с расширением `.c`
2. Добавьте базовый шаблон с использованием rbc.h:

```c
#include "rbc.h"

task main()
{
  // Ваш код
}
```

### Запуск программы

#### Через VS Code

- Перейдите в Run and Debug (`Ctrl+Shift+D`) и нажмите зеленую кнопку

#### Через терминал VS Code

1. Нажмите `Ctrl+Shift+F5` (если настроены горячие клавиши)
2. Откройте терминал (`Ctrl+Shift+``)
3. Введите пароль (Пароль по умолчанию: `maker`)

#### Через File Browser на EV3

1. Файл появится в File Browser на роботе
2. Выберите файл и нажмите кнопку центра для запуска

---

## Дополнительные ресурсы

- **Официальная документация EV3dev:** [https://www.ev3dev.org/docs/](https://www.ev3dev.org/docs/)
- **Библиотека ev3dev-c:** [https://github.com/in4lio/ev3dev-c](https://github.com/in4lio/ev3dev-c)
- **Форк с библиотекой rbc.h:** [https://github.com/Evolitist/ev3dev-c](https://github.com/Evolitist/ev3dev-c)
- **Примеры кода на C:** [https://github.com/ev3dev/ev3dev-lang](https://github.com/ev3dev/ev3dev-lang)
- **Сообщество в Gitter:** [https://gitter.im/ev3dev/chat](https://gitter.im/ev3dev/chat)
- **Форум:** [https://www.ev3dev.org/docs/support/](https://www.ev3dev.org/docs/support/)

---
